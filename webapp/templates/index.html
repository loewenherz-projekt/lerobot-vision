<!DOCTYPE html>
<html>
<head>
    <title>LeRobot Web</title>
    <script>
        async function loadModels() {
            const resp = await fetch('/models');
            const data = await resp.json();
            const sel = document.getElementById('model_select');
            sel.innerHTML = '';
            data.models.forEach(m => {
                const opt = document.createElement('option');
                opt.value = m; opt.textContent = m;
                if (m === data.selected) opt.selected = true;
                sel.appendChild(opt);
            });
        }

        async function selectModel() {
            const name = document.getElementById('model_select').value;
            await fetch('/models/select?name=' + name, {method: 'POST'});
        }

        async function updatePositions() {
            const resp = await fetch('/robot/positions');
            const data = await resp.json();
            document.getElementById('positions').textContent = data.positions.join(', ');
        }

        async function sendChat() {
            const text = document.getElementById('chat_input').value;
            const resp = await fetch('/nlp', {method:'POST', body: new URLSearchParams({text})});
            const data = await resp.json();
            document.getElementById('chat_log').textContent = JSON.stringify(data.actions);
        }

        window.onload = () => {
            loadModels();
            updatePositions();
        };
    </script>
</head>
<body>
<h1>LeRobot Web Interface</h1>
<form action="/start" method="post">
    Left camera: <input type="number" name="left" value="0">
    Right camera: <input type="number" name="right" value="1">
    Side by side: <input type="checkbox" name="side_by_side">
    <button type="submit">Start</button>
</form>
<div>
    <img src="/stream/left" width="320">
    <img src="/stream/right" width="320">
</div>
<h2>Calibration</h2>
<form action="/calibration/start" method="post">
    Board width: <input type="number" name="board_w" value="7">
    Board height: <input type="number" name="board_h" value="6">
    Square size: <input type="number" step="0.1" name="size" value="1.0">
    <button type="submit">Start Calibration</button>
</form>
<form action="/calibration/capture" method="post">
    <button type="submit">Capture</button>
</form>
<form action="/calibration/finish" method="post">
    <button type="submit">Finish</button>
</form>
<div>
    <h3>Model</h3>
    <select id="model_select" onchange="selectModel()"></select>
</div>
<div>
    <h3>Robot positions</h3>
    <span id="positions"></span>
    <button onclick="updatePositions()">Refresh</button>
</div>
<div>
    <h3>Chat</h3>
    <input id="chat_input" type="text">
    <button onclick="sendChat()">Send</button>
    <pre id="chat_log"></pre>
</div>
</body>
</html>
